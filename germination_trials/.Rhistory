setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6)#,7,8,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,50,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6)#,7,8,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,20,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
loadmodels <- FALSE
runpart1 <- FALSE
if(length(grep("Lizzie", getwd())>0)) {
setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6)#,7,8,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,50,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
loadmodels <- FALSE
runpart1 <- FALSE
if(length(grep("Lizzie", getwd())>0)) {
setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6,7,8,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,55,by=1) ## number of replicates
repz<-seq(1,25,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
summary(modintxn)$summary[c("a_d","bc_d","bf_d","a_beta","bc_beta","bf_beta","a_t50","bc_t50","bf_t50","inter_d","inter_beta","inter_t50","sigma"),]
modintxn.mega = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 8000, warmup= 7000, chain=4)
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
loadmodels <- FALSE
runpart1 <- FALSE
if(length(grep("Lizzie", getwd())>0)) {
setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6,7,8,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,15,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
loadmodels <- FALSE
runpart1 <- FALSE
if(length(grep("Lizzie", getwd())>0)) {
setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6,7,8)#,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,25,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
loadmodels <- FALSE
runpart1 <- FALSE
if(length(grep("Lizzie", getwd())>0)) {
setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6,7,8)#,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,50,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
rm(list=ls())
options(stringsAsFactors = FALSE)
graphics.off()
loadmodels <- FALSE
runpart1 <- FALSE
if(length(grep("Lizzie", getwd())>0)) {
setwd("~/Documents/git/projects/misc/dan/timetogerminate/germination_trials")
} else setwd("~/Documents/git/timetogerminate/germination_trials")
if(loadmodels){
load("fake_germ_models") # emw: What is this, do I need it? DB...no its only so I can load models but none currently work.
}
library(rstan)
library(tidyr)
library(drc)
library(dplyr)
library(shinystan)
library(extraDistr)
##The code below genrates fake data with 10 levels of chilling and 2 levels of forcing, with no interactions between treatments.
time <-seq(0,24,by=1) #time of each trial
chilltreat <- c(0,1,2,3,4,5,6,7,8,9,10) # level of chilling, continuous data
forcetreat<-c(0,1) #levels of forgince
sigma_y <- 0.01 ## small signma
t50.a <- 15 #intercept of t50
t50.cb <- -1 # slope of t50 with chilling
t50.fb<--.5 # slope of t50 with forcing
beta.a <- 4 #intercept of beta (shape paramenter)
beta.cb<-.5 #slope of beta chilling
beta.fb<-1 #slope of beta forcing
d.a <- 0.4 # intercept of d (maximum germination %)
d.cb<-0.03 # slope of d chilling
d.fb<-0.3 # slope of d forcing
#Interactions
d.cxf<--0.02
t50.cxf<-.5
b.cxf<--.2
repz<-seq(1,25,by=1) ## number of replicates
###make a fake data list with above paramenters
df2<-data.frame(time=numeric(), y=numeric(),chilltreat=numeric(),forcetreat=numeric(),ID=numeric())  ##generate fake data
for (j in c(1:length(forcetreat))){
y <- c()
for (i in c(1:length(chilltreat))){
y <- c()
for(k in c(1:length(repz))){
y<-(d.fb*forcetreat[j]+d.cb*chilltreat[i]+d.cxf*(forcetreat[j]*chilltreat[i])+d.a)/(1+((time/(t50.fb*forcetreat[j]+t50.cb*chilltreat[i]+t50.cxf*(forcetreat[j]*chilltreat[i])+t50.a))^-(beta.fb*forcetreat[j]+beta.cb*chilltreat[i]+b.cxf*(forcetreat[j]*chilltreat[i])+beta.a)))
#y<-(d.b*treat[i]+d.a)/(1+((time/(t50.b*treat[i]+t50.a))^-(beta.a)))
dfhere2 <- data.frame(time=time, y=rtnorm(length(y),y,sigma_y,a=0,b=Inf),chilltreat=rep(chilltreat[i], length(y)),forcetreat=rep(forcetreat[j], length(y)),ID=rep(repz[k],length(y)))
df2 <- rbind(df2, dfhere2) ## rbind it here for safty
}
}
}
ploty2<-ggplot(df2,aes(time,y))+geom_point(aes(color=as.factor(chilltreat),shape=as.factor(forcetreat))) #plot fake data
ploty2+geom_line(stat = "summary", fun.y = mean, aes(color=as.factor(chilltreat),linetype=as.factor(forcetreat))) # plot fake data with average lines
df.adj2<-df2
df.adj2$time<-ifelse(df.adj2$time==0,0.0001,df.adj2$time) ### change time=0 to .0001 because models struggle to fit zero values
data.list2<-with(df.adj2,
list(Y=y,
t=time,
chill=chilltreat,
force=forcetreat,
N=nrow(df.adj2) # datalist
)
)
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
#interaction model
modintxn = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup=5000, chain=1) #1 chain only
summary(modintxn)$summary[c("a_d","bc_d","bf_d","a_beta","bc_beta","bf_beta","a_t50","bc_t50","bf_t50","inter_d","inter_beta","inter_t50","sigma"),]
modintxn.mega = stan('stan/fakeseedgoodchill_winters.stan', data = data.list2,
iter = 6000, warmup= 5000, chain=4) ## chains
save.image("fake_germ_models")
