browseVignettes(package = 'germinationmetrics')
browseVignettes(package = 'germinationmetrics')
library(rworldmap)
newmap <- getMap(resolution = "low")
library(rworldmap)
###what does the photoperiod response curve look like?
## look at viheraaarnio06
#partenen98
#schnabel87
#howe95
# read in data
#plot responsetime ~ photoperiod
#see if it is linear
rm(list=ls())
options(stringsAsFactors = FALSE)
library(tidyverse)
library(ggplot2)
library(ggthemes)
setwd("~/Documents/git/ospree/analyses")
bb.all<- read.csv("output/ospree_clean_withchill_BB.csv", header=TRUE)
bb.some <- subset(bb.all, respvar.simple=="daystobudburst"|respvar.simple=="percentbudburst")
bbdat <- subset(bb.some, response.time!="")
colnames(bbdat)
###plots
hei<-subset(bbdat,datasetID=="heide93a"& study=="exp3")
hei<-subset(hei,species=="sylvatica")
hei$days_cent<-hei$response.time-(mean(hei$response.time)/sd(hei$response.time))
hei$thingy[hei$population=="As.Norway"]<-9
hei$thingy[hei$population=="As.Norway (assuming)"]<-10
hei$thingy[hei$population=="Basel"]<-11
hei$thingy[hei$population=="Carpathia Mtns"]<-12
hei$thingy[hei$population=="Copenhagen"]<-13
ash1<-subset(bbdat,datasetID=="ashby62"&population=="Southwestern Michigan")
ash2<-subset(bbdat,datasetID=="ashby62"&population=="Central Wisconsin")
sh1<-subset(ash1,response.time<999)
ash2<-subset(ash2,response.time<999)
ash1$thingy[ash1$fieldsample.date=="11-Dec-1956"]<-"Mich1"
ash1$thingy[ash1$fieldsample.date=="8-Jan-1957"]<-"Mich2"
ash1$thingy[ash1$fieldsample.date=="5-Feb-1957"]<-"Mich3"
ash1$thingy[ash1$fieldsample.date=="4-Mar-1957"]<-"Mich4"
ash2$thingy[ash2$fieldsample.date=="11-Dec-1956"]<-"Wisc1"
ash2$thingy[ash2$fieldsample.date=="8-Jan-1957"]<-"Wisc2"
ash2$thingy[ash2$fieldsample.date=="5-Feb-1957"]<-"Wisc3"
ash2$thingy[ash2$fieldsample.date=="4-Mar-1957"]<-"Wisc4"
ash<-rbind(ash2,ash1)
ash$days_cent<-ash$response.time-mean(ash$response.time)/sd(ash$response.time)
caf<-subset(bbdat,datasetID=="caffarra11b"& study=="exp2"& response.time!=999.0)
table(caf$photoperiod_day)
table(caf$forcetemp)
caf$thingy[caf$chilldays==0]<-5
caf$thingy[caf$chilldays==30]<-6
caf$thingy[caf$chilldays==55]<-7
caf$thingy[caf$chilldays==95]<-8
caf$days_cent<-caf$response.time-(mean(caf$response.time)/sd(caf$response.time))
ha<-rbind(caf,hei,ash)
ha$chill_level[ha$Total_Chill_portions<1] <- "None"
ha$chill_level[ha$Total_Chill_portions> 1 & ha$Total_Chill_portions < 44] <- "Low"
ha$chill_level[ha$Total_Chill_portions> 44 & ha$Total_Chill_portions < 69] <- "Med"
ha$chill_level[ha$Total_Chill_portions> 69 & ha$Total_Chill_portions < 106] <- "High"
ha$chill_level[ha$Total_Chill_portions> 106] <- "Very High"
table(ha$Total_Chill_portions)
ha$chill_level <- factor(ha$chill_level, levels=c("None", "Low", "Med","High","Very High"))
library(grid)
ha<-unite(ha,lat.long,provenance.lat,provenance.long,sep=",")
ha<-unite(ha,GENSPA,genus,species,sep=" ")
ha2<-filter(ha,response.time<80)
library(egg)
colorz<-c("red","orange","dark yellow","light blue","purple")
linez<-c("solid","dashed","dotted")
plotx<-ggplot(ha,(aes(as.numeric(photoperiod_day),response.time)))+geom_rect(aes(xmin=8,xmax=16,ymin=-15,ymax=80),fill="grey98",color="grey44", alpha = .1)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+ylab("Days to budburst")+xlab("Photoperiod (hours)")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"),name="Chill Level")+scale_linetype_manual(values=c("solid","dotted","dashed"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))
ploty<-ggplot(ha2,(aes(as.numeric(photoperiod_day),response.time)))+xlim(8,16)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+theme_base()+theme(legend.position = "none",axis.title.x=element_blank(),axis.title.y=element_blank())+ggtitle("zoom")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"))+scale_linetype_manual(values=c("solid","dotted","dashed"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))+theme(panel.background = element_rect(fill = "grey98",color="grey44"))
quantile(ha$Total_Chill_portions)
vp <- viewport(width = 0.4, height = 0.5, x = 0.4, y = .95,just=c("left","top"))
plotx+theme_base()
print(ploty, vp = vp, )
plotx<-ggplot(ha,(aes(as.numeric(photoperiod_day),response.time)))+geom_rect(aes(xmin=8,xmax=16,ymin=-15,ymax=80),fill="grey98",color="grey44", alpha = .1)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+ylab("Days to budburst")+xlab("Photoperiod (hours)")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"),name="Chill Level")+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))
plotx
ploty<-ggplot(ha2,(aes(as.numeric(photoperiod_day),response.time)))+xlim(8,16)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+theme_base()+theme(legend.position = "none",axis.title.x=element_blank(),axis.title.y=element_blank())+ggtitle("zoom")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"))+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))+theme(panel.background = element_rect(fill = "grey98",color="grey44"))
quantile(ha$Total_Chill_portions)
vp <- viewport(width = 0.4, height = 0.5, x = 0.4, y = .95,just=c("left","top"))
plotx+theme_base()
print(ploty, vp = vp, )
ha$chill_level <- factor(ha$chill_level, levels=c("None (<1)", "Low(1-44)", "Med (45-69)","High (70-106)","Very High (>106)"))
library(grid)
ha<-unite(ha,lat.long,provenance.lat,provenance.long,sep=",")
ha<-unite(ha,GENSPA,genus,species,sep=" ")
ha2<-filter(ha,response.time<80)
library(egg)
colorz<-c("red","orange","dark yellow","light blue","purple")
linez<-c("solid","dashed","dotted")
plotx<-ggplot(ha,(aes(as.numeric(photoperiod_day),response.time)))+geom_rect(aes(xmin=8,xmax=16,ymin=-15,ymax=80),fill="grey98",color="grey44", alpha = .1)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+ylab("Days to budburst")+xlab("Photoperiod (hours)")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"),name="Chill Level")+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))
ploty<-ggplot(ha2,(aes(as.numeric(photoperiod_day),response.time)))+xlim(8,16)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+theme_base()+theme(legend.position = "none",axis.title.x=element_blank(),axis.title.y=element_blank())+ggtitle("zoom")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"))+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))+theme(panel.background = element_rect(fill = "grey98",color="grey44"))
quantile(ha$Total_Chill_portions)
vp <- viewport(width = 0.4, height = 0.5, x = 0.4, y = .95,just=c("left","top"))
plotx+theme_base()
print(ploty, vp = vp, )
ha<-rbind(caf,hei,ash)
ha$chill_level[ha$Total_Chill_portions<1] <- "None"
ha$chill_level[ha$Total_Chill_portions> 1 & ha$Total_Chill_portions < 44] <- "Low"
ha$chill_level[ha$Total_Chill_portions> 44 & ha$Total_Chill_portions < 69] <- "Med"
ha$chill_level[ha$Total_Chill_portions> 69 & ha$Total_Chill_portions < 106] <- "High"
ha$chill_level[ha$Total_Chill_portions> 106] <- "Very High"
table(ha$Total_Chill_portions)
ha$chill_level <- factor(ha$chill_level, levels=c("None (<1)", "Low(1-44)", "Med (45-69)","High (70-106)","Very High (>106)"))
library(grid)
ha<-unite(ha,lat.long,provenance.lat,provenance.long,sep=",")
ha<-unite(ha,GENSPA,genus,species,sep=" ")
ha2<-filter(ha,response.time<80)
library(egg)
colorz<-c("red","orange","dark yellow","light blue","purple")
linez<-c("solid","dashed","dotted")
plotx<-ggplot(ha,(aes(as.numeric(photoperiod_day),response.time)))+geom_rect(aes(xmin=8,xmax=16,ymin=-15,ymax=80),fill="grey98",color="grey44", alpha = .1)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+ylab("Days to budburst")+xlab("Photoperiod (hours)")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"),name="Chill Level")+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))
ploty<-ggplot(ha2,(aes(as.numeric(photoperiod_day),response.time)))+xlim(8,16)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+theme_base()+theme(legend.position = "none",axis.title.x=element_blank(),axis.title.y=element_blank())+ggtitle("zoom")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"))+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))+theme(panel.background = element_rect(fill = "grey98",color="grey44"))
quantile(ha$Total_Chill_portions)
vp <- viewport(width = 0.4, height = 0.5, x = 0.4, y = .95,just=c("left","top"))
plotx+theme_base()
print(ploty, vp = vp, )
ha$chill_level <- factor(ha$chill_level, levels=c("None (<1)", "Low(1-44)", "Med (45-69)","High (70-106)","Very High (>106)"))
View(ha)
ha<-rbind(caf,hei,ash)
ha$chill_level[ha$Total_Chill_portions<1] <- "None (<1)"
ha$chill_level[ha$Total_Chill_portions> 1 & ha$Total_Chill_portions < 44] <- "Low (1-44)"
ha$chill_level[ha$Total_Chill_portions> 44 & ha$Total_Chill_portions < 69] <- "Med (45-69)"
ha$chill_level[ha$Total_Chill_portions> 69 & ha$Total_Chill_portions < 106] <- "High (70-106)"
ha$chill_level[ha$Total_Chill_portions> 106] <- "Very High (>106)"
table(ha$Total_Chill_portions)
ha$chill_level <- factor(ha$chill_level, levels=c("None (<1)", "Low (1-44)", "Med (45-69)","High (70-106)","Very High (>106)"))
library(grid)
ha<-unite(ha,lat.long,provenance.lat,provenance.long,sep=",")
ha<-unite(ha,GENSPA,genus,species,sep=" ")
ha2<-filter(ha,response.time<80)
library(egg)
colorz<-c("red","orange","dark yellow","light blue","purple")
linez<-c("solid","dashed","dotted")
plotx<-ggplot(ha,(aes(as.numeric(photoperiod_day),response.time)))+geom_rect(aes(xmin=8,xmax=16,ymin=-15,ymax=80),fill="grey98",color="grey44", alpha = .1)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+ylab("Days to budburst")+xlab("Photoperiod (hours)")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"),name="Chill Level")+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))
ploty<-ggplot(ha2,(aes(as.numeric(photoperiod_day),response.time)))+xlim(8,16)+geom_line(aes(color=chill_level,linetype=GENSPA,group=thingy),size=1.1)+theme_base()+theme(legend.position = "none",axis.title.x=element_blank(),axis.title.y=element_blank())+ggtitle("zoom")+scale_color_manual(values=c("red","sienna2","darkseagreen4","deepskyblue3","purple"))+scale_linetype_manual(values=c("solid","dotted","twodash"),name="Taxa",guide=guide_legend(label.theme = element_text(angle = 0, face = "italic")))+theme(panel.background = element_rect(fill = "grey98",color="grey44"))
quantile(ha$Total_Chill_portions)
vp <- viewport(width = 0.4, height = 0.5, x = 0.4, y = .95,just=c("left","top"))
plotx+theme_base()
print(ploty, vp = vp, )
###a script to amke my data survival formated
rm(list=ls())
options(stringsAsFactors = FALSE)
library(survival)
library(ggplot2)
library(dplyr)
library("ggfortify")
library("coxme")
library("icenReg")
library("emmeans")
###make a small data set
#day<-c(0,2,4,6,8,10,0,2,4,6,8,10)
#end<-c(2,4,6,8,10,Inf,2,4,6,8,10,Inf)
#germination<-c(0,0,4,1,2,3,0,2,3,3,1,1)
#name<-c("A","A","A","A","A","A","B","B","B","B","B","B"
#dater<-uncount(dater,germination,.remove=TRUE)
#dater$germinationed<-ifelse(dater$day==10,0,1)
###This seems to work
setwd("~/Documents/git/timetogerminate/germination_trials/input")
daily.dat<-read.csv("daily_dat_nointerval.csv",header=TRUE)
d<-read.csv("germ_data_forDRC.csv",header= TRUE)
goober<-uncount(d,germination,.remove=FALSE)
goober$DAY<-ifelse(goober$DAY==-Inf,NA,goober$DAY)
goober$END<-ifelse(goober$END==Inf,NA,goober$END)
goober$censor<-ifelse(goober$END==0,2,1)
goober<- within(goober, censor[DAY==25 ]<-0)
goober$chill_time<-NA
goober<- within(goober, chill_time[COLD=="O" ]<-0)
goober<- within(goober, chill_time[COLD=="A" ]<-14)
goober<- within(goober, chill_time[COLD=="B" ]<-28)
goober<- within(goober, chill_time[COLD=="C" ]<-35)
goober<- within(goober, chill_time[COLD=="D" ]<-42)
goober<- within(goober, chill_time[COLD=="E" ]<-49)
goober<- within(goober, chill_time[COLD=="f" ]<-56)
goober<- within(goober, chill_time[COLD=="G" ]<-63)
goober<- within(goober, chill_time[COLD=="H" ]<-77)
goober<- within(goober, chill_time[COLD=="i" ]<-91)
goober$warmT<-NA
goober<- within(goober, warmT[INC=="H" ]<-25)
goober<- within(goober, warmT[INC=="L" ]<-20)
write.csv(goober,"interval_survival_data.csv")
Cry<-filter(goober,Taxa=="Cryptotaenia canadensis")
Cry<-filter(Cry,DAY!=0)##removes left censoring
#gooby<-filter(Cry,!is.na(END))
#Cry1<-filter(Cry,COLD=="O")
Surv.Obj <- Surv(Cry$DAY, Cry$END,type = 'interval2')
mod2 <- survreg(Surv.Obj ~ warmT+chill_time, dist = "lognormal", data = Cry) ##This model throughs out left censoring, and assumes all right censored individuals will germinat
summary(mod2)
emmeans(mod2, ~ INC+COLD, transform = "response")
km <- survreg(Surv.Obj ~INC+COLD,data=Cry)
emmeans(km, ~ INC+COLD, transform = "response")
#fit <- ic_sp(cbind(DAY, END) ~ INC,   data = Cry, model = 'ph', bs_samples = 10)
#summary(fit)
#?ic_sp()
####converts toruvival anaysis
goo<-uncount(daily.dat,germ.daily,.remove=FALSE)
goo$germinated<-1
goo2<-filter(daily.dat,DAY==25 &germ.daily==0)
goo2<-uncount(goo2,viable,.remove=FALSE)
goo2$germinated<-0
data<-rbind(goo,goo2)
colnames(data)
surv.data<-dplyr::select(data,Taxa,INC,COLD,plate_num,date,DAY,germinated)
goober<-surv.data
goober$chill_time<-NA
goober<- within(goober,chill_time[COLD=="0" ]<-0)
goober<- within(goober, chill_time[COLD=="A" ]<-14)
goober<- within(goober, chill_time[COLD=="B" ]<-28)
goober<- within(goober, chill_time[COLD=="C" ]<-35)
goober<- within(goober, chill_time[COLD=="D" ]<-42)
goober<- within(goober, chill_time[COLD=="E" ]<-49)
goober<- within(goober, chill_time[COLD=="f" ]<-56)
goober<- within(goober, chill_time[COLD=="G" ]<-63)
goober<- within(goober, chill_time[COLD=="H" ]<-77)
goober<- within(goober, chill_time[COLD=="i" ]<-91)
daily.dat<-read.csv("daily_dat_nointerval.csv",header=TRUE)
View(daily.dat)
setwd("~/Documents/git/timetogerminate/germination_trials/input")
daily.dat<-read.csv("daily_dat_nointerval.csv",header=TRUE)
rm(list=ls())
options(stringsAsFactors = FALSE)
setwd("~/Documents/git/timetogerminate/germination_trials/input")
daily.dat<-read.csv("daily_dat_nointerval.csv",header=TRUE)
d<-read.csv("daily_dat_nointerval.csv",header=TRUE)
rm(list=ls())
options(stringsAsFactors = FALSE)
setwd("~/Documents/git/timetogerminate/germination_trials/input")
d<-read.csv("daily_dat_nointerval.csv",header=TRUE)
X<-split(d, with(d, d$Taxa), drop = TRUE)
Y <- lapply(seq_along(X), function(x) as.data.frame(X[[x]])[, 1:14])
names(Y) <-(c(specieslist))
list2env(Y, envir = .GlobalEnv)
d<-filter(d, !Taxa %in% c("Phlox cuspidata","Impatiens capensis", "Carex grisea"))
specieslist<-sort(unique(d$Taxa))
X<-split(d, with(d, d$Taxa), drop = TRUE)
Y <- lapply(seq_along(X), function(x) as.data.frame(X[[x]])[, 1:14])
names(Y) <-(c(specieslist))
list2env(Y, envir = .GlobalEnv)
install.packages('germinationmetrics', dependencies=TRUE)
devtools::install_github("aravind-j/germinationmetrics")
#devtools::install_github("aravind-j/germinationmetrics")
library(germinetrics)
devtools::install_github("aravind-j/germinationmetrics")
